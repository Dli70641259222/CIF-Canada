<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Car B/L Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .checkboxes label { margin-right: 10px; }
    .section-box {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      background: #f9f9f9;
    }
  </style>
</head>
<body class="p-4">
  <div class="container">
    <h2 class="mb-4 text-center">Bill of Lading Generator</h2>
    <form id="bolForm">

      <!-- Shipper Info -->
      <div class="section-box">
        <h5>Shipper Info</h5>
        <div class="mb-3"><label>Shipper Name:</label><input type="text" class="form-control" id="shipper" required /></div>
        <div class="mb-3"><label>Shipper Address:</label><input type="text" class="form-control" id="shipperAddress" /></div>
        <div class="mb-3"><label>Shipper Email:</label><input type="email" class="form-control" id="shipperEmail" /></div>
        <div class="mb-3"><label>Shipper Phone:</label><input type="text" class="form-control" id="shipperPhone" /></div>
        <div class="mb-3"><label>Shipper Tax ID:</label><input type="text" class="form-control" id="shipperTaxId" /></div>
      </div>

      <!-- Consignee Info -->
      <div class="section-box">
        <h5>Consignee Info</h5>
        <div class="mb-3"><label>Consignee Name:</label><input type="text" class="form-control" id="consignee" required /></div>
        <div class="mb-3"><label>Consignee Address:</label><input type="text" class="form-control" id="consigneeAddress" /></div>
        <div class="mb-3"><label>Consignee Email:</label><input type="email" class="form-control" id="consigneeEmail" /></div>
        <div class="mb-3"><label>Consignee Phone:</label><input type="text" class="form-control" id="consigneePhone" /></div>
        <div class="mb-3"><label>Consignee Tax ID:</label><input type="text" class="form-control" id="consigneeTaxId" /></div>
      </div>

      <!-- Notify Party Info -->
      <div class="section-box">
        <h5>Notify Party</h5>
        <div class="mb-3"><label>Notify Name:</label><input type="text" class="form-control" id="notify" /></div>
        <div class="mb-3"><label>Notify Address:</label><input type="text" class="form-control" id="notifyAddress" /></div>
        <div class="mb-3"><label>Notify Email:</label><input type="email" class="form-control" id="notifyEmail" /></div>
        <div class="mb-3"><label>Notify Phone:</label><input type="text" class="form-control" id="notifyPhone" /></div>
      </div>

      <!-- Shipment Details -->
      <div class="row mb-3">
        <div class="col-md-6"><label>Invoicing:</label><input type="text" class="form-control" id="invoicing" /></div>
        <div class="col-md-3"><label>Port of Loading:</label><input type="text" class="form-control" id="port" /></div>
        <div class="col-md-3"><label>Destination:</label><input type="text" class="form-control" id="destination" /></div>
      </div>

      <!-- Car Details -->
      <h5>Car Details</h5>
      <div id="carList"></div>
      <button type="button" class="btn btn-secondary my-3" onclick="addCar()">Add Car</button>
      <br />
      <button type="submit" class="btn btn-primary">Generate B/L PDF</button>
    </form>
  </div>

  <script>
    let carIndex = 0;
    function addCar() {
      const container = document.createElement('div');
      container.classList.add('card', 'p-3', 'mb-3');
      container.innerHTML = `
        <div class="row mb-2">
          <div class="col-md-3"><label>Car Name:</label><input type="text" class="form-control" name="carName${carIndex}" /></div>
          <div class="col-md-3"><label>VIN:</label><input type="text" class="form-control" name="vin${carIndex}" /></div>
          <div class="col-md-2"><label>Price:</label><input type="text" class="form-control" name="price${carIndex}" /></div>
          <div class="col-md-4"><label>B13 Info:</label><input type="text" class="form-control" name="b13${carIndex}" /></div>
        </div>
        <div class="checkboxes">
          <label><input type="checkbox" name="title${carIndex}" /> Title</label>
          <label><input type="checkbox" name="key${carIndex}" /> Key</label>
          <label><input type="checkbox" name="r${carIndex}" /> R</label>
          <label><input type="checkbox" name="acc${carIndex}" /> Acc</label>
          <label><input type="checkbox" name="nr${carIndex}" /> NR</label>
          <label><input type="checkbox" name="nacc${carIndex}" /> NACC</label>
        </div>
      `;
      document.getElementById('carList').appendChild(container);
      carIndex++;
    }

    document.getElementById('bolForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;

      doc.setFontSize(16);
      doc.text('BILL OF LADING', 105, y, { align: 'center' });
      y += 12;

      const writeBlock = (title, entries) => {
        doc.setFont(undefined, 'bold');
        doc.text(`${title}:`, 10, y);
        doc.setFont(undefined, 'normal');
        y += 6;
        entries.forEach(([label, value]) => {
          doc.text(`  ${label}: ${value}`, 12, y);
          y += 5;
        });
        y += 2;
      };

      writeBlock('Shipper', [
        ['Name', document.getElementById('shipper').value],
        ['Address', document.getElementById('shipperAddress').value],
        ['Email', document.getElementById('shipperEmail').value],
        ['Phone', document.getElementById('shipperPhone').value],
        ['Tax ID', document.getElementById('shipperTaxId').value]
      ]);

      writeBlock('Consignee', [
        ['Name', document.getElementById('consignee').value],
        ['Address', document.getElementById('consigneeAddress').value],
        ['Email', document.getElementById('consigneeEmail').value],
        ['Phone', document.getElementById('consigneePhone').value],
        ['Tax ID', document.getElementById('consigneeTaxId').value]
      ]);

      writeBlock('Notify Party', [
        ['Name', document.getElementById('notify').value],
        ['Address', document.getElementById('notifyAddress').value],
        ['Email', document.getElementById('notifyEmail').value],
        ['Phone', document.getElementById('notifyPhone').value]
      ]);

      writeBlock('Shipment Details', [
        ['Invoicing', document.getElementById('invoicing').value],
        ['Port of Loading', document.getElementById('port').value],
        ['Destination', document.getElementById('destination').value]
      ]);

      // Car Details Table
      doc.setFont(undefined, 'bold');
      doc.text('Car Details:', 10, y);
      y += 6;

      const headers = ['#', 'Car Name', 'VIN', 'Price', 'B13 Info', 'Condition'];
      const startX = 10;
      const rowHeight = 6;
      const colWidths = [8, 40, 45, 20, 30, 50];

      // Header
      doc.setFont(undefined, 'bold');
      headers.forEach((header, i) => {
        doc.text(header, startX + colWidths.slice(0, i).reduce((a, b) => a + b, 0), y);
      });
      y += rowHeight;
      doc.setFont(undefined, 'normal');

      const carCards = document.querySelectorAll('#carList .card');
      carCards.forEach((card, index) => {
        const name = card.querySelector(`[name="carName${index}"]`).value;
        const vin = card.querySelector(`[name="vin${index}"]`).value;
        const price = card.querySelector(`[name="price${index}"]`).value;
        const b13 = card.querySelector(`[name="b13${index}"]`).value;
        const conds = ['title', 'key', 'r', 'acc', 'nr', 'nacc'].map(id => card.querySelector(`[name="${id}${index}"]`).checked ? id.toUpperCase() : '').filter(Boolean).join(', ');

        const values = [index + 1, name, vin, price, b13, conds];
        values.forEach((val, i) => {
          doc.text(String(val), startX + colWidths.slice(0, i).reduce((a, b) => a + b, 0), y);
        });
        y += rowHeight;
        if (y > 270) { doc.addPage(); y = 10; }
      });

      doc.save('bill_of_lading.pdf');
    });
  </script>
</body>
</html>
